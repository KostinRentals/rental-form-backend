<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tenant Application Form</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .form-container {
            max-width: 100vw;
            width: 100%;
            margin: 1rem auto;
            padding: 1rem;
            background-color: #ffffff;
            border-radius: 1.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            line-height: 1.5;
            box-sizing: border-box;
            display: block;
        }
        @media (min-width: 640px) {
            .form-container {
                max-width: 700px;
                padding: 2rem;
            }
        }
        @media (min-width: 1024px) {
            .form-container {
                max-width: 8.5in;
            }
        }
        h1,
        h2 {
            text-align: center;
            color: #1f2937;
        }
        h1 {
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 1rem;
            margin-bottom: 1.5rem;
        }
        h2 {
            border-bottom: 1px solid #f3f4f6;
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
            font-weight: 600;
        }
        .form-section {
            margin-bottom: 2rem;
        }
        .grid-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }
        @media (min-width: 640px) {
            .grid-container.sm\:grid-cols-2 {
                grid-template-columns: repeat(2, 1fr);
            }
            .form-group.sm\:col-span-2 {
                grid-column: span 2;
            }
        }
        .form-group {
            margin-bottom: 1rem;
        }
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #4b5563;
        }
        input[type="text"],
        input[type="email"],
        input[type="tel"],
        input[type="date"],
        textarea {
            display: block;
            width: 100%;
            padding: 0.75rem;
            background-color: #f9fafb;
            border: 1px solid #d1d5db;
            border-radius: 0.75rem;
            font-size: 1rem;
            line-height: 1.5rem;
            transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            outline: none;
            box-sizing: border-box;
        }
        input[type="text"]:focus,
        input[type="email"]:focus,
        input[type="tel"]:focus,
        input[type="date"]:focus,
        textarea:focus {
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.2);
        }
        .signature-block {
            margin-top: 30px;
        }
        .signature-line {
            display: block;
            border-bottom: 1px dashed #4b5563;
            width: 100%;
            margin-top: 50px;
        }
        /* Responsive button spacing */
        .flex.space-x-4 > * {
            margin-bottom: 0.5rem;
        }
        @media (min-width: 640px) {
            .flex.space-x-4 > * {
                margin-bottom: 0;
            }
        }
    </style>
</head>

<body>
    <form class="form-container" id="application-form">
        <h1 class="text-3xl font-bold">Tenant Application Form</h1>
        <p class="text-center text-gray-500 mb-6">Please complete this form in its entirety. All information is confidential.</p>

        <!-- Personal Information Section -->
        <div class="form-section">
            <h2 class="text-xl">1. Personal Information</h2>
            <div class="grid-container sm:grid-cols-2">
                <div class="form-group sm:col-span-2">
                    <label for="full-name">Full Legal Name:</label>
                    <input type="text" id="full-name" name="full-name">
                </div>
                <div class="form-group">
                    <label for="dob">Date of Birth (YYYY/MM/DD):</label>
                    <input type="date" id="dob" name="dob">
                </div>
                <div class="form-group">
                    <label for="phone">Phone Number:</label>
                    <input type="tel" id="phone" name="phone">
                </div>
                <div class="form-group sm:col-span-2">
                    <label for="email">Email Address:</label>
                    <input type="email" id="email" name="email">
                </div>
                <div class="form-group sm:col-span-2">
                    <label for="current-address">Current Address:</label>
                    <input type="text" id="current-address" name="current-address">
                </div>
                <div class="form-group sm:col-span-2">
                    <label for="current-address-length">Length at Current Address:</label>
                    <input type="text" id="current-address-length" name="current-address-length">
                </div>
                <div class="form-group sm:col-span-2">
                    <label for="previous-address">Previous Address (if less than 2 years at current):</label>
                    <input type="text" id="previous-address" name="previous-address">
                </div>
            </div>
        </div>

        <!-- Employment & Income Verification Section -->
        <div class="form-section">
            <h2 class="text-xl">2. Employment & Income Verification</h2>
            <div class="grid-container sm:grid-cols-2">
                <div class="form-group sm:col-span-2">
                    <label for="employer">Current Employer:</label>
                    <input type="text" id="employer" name="employer">
                </div>
                <div class="form-group">
                    <label for="position">Position/Job Title:</label>
                    <input type="text" id="position" name="position">
                </div>
                <div class="form-group">
                    <label for="employment-length">Length of Employment:</label>
                    <input type="text" id="employment-length" name="employment-length">
                </div>
                <div class="form-group">
                    <label for="employer-contact">Employer Contact (HR/Manager):</label>
                    <input type="text" id="employer-contact" name="employer-contact">
                </div>
                <div class="form-group">
                    <label for="monthly-income">Monthly Income:</label>
                    <input type="text" id="monthly-income" name="monthly-income">
                </div>
                <div class="form-group flex flex-col justify-end">
                    <label class="mb-2">Proof of Income Provided:</label>
                    <div class="flex items-center space-x-4">
                        <label class="inline-flex items-center"><input type="radio" name="income-proof" value="Yes" class="mr-2"> Yes</label>
                        <label class="inline-flex items-center"><input type="radio" name="income-proof" value="No" class="mr-2"> No</label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Rental History Section -->
        <div class="form-section">
            <h2 class="text-xl">3. Rental History</h2>
            <div class="grid-container sm:grid-cols-2">
                <div class="form-group sm:col-span-2">
                    <label for="current-landlord">Current Landlord Name & Contact:</label>
                    <input type="text" id="current-landlord" name="current-landlord">
                </div>
                <div class="form-group sm:col-span-2">
                    <label for="reason-leaving">Reason for Leaving:</label>
                    <textarea id="reason-leaving" name="reason-leaving" rows="2"></textarea>
                </div>
                <div class="form-group sm:col-span-2">
                    <label for="previous-landlord">Previous Landlord Name & Contact:</label>
                    <input type="text" id="previous-landlord" name="previous-landlord">
                </div>
            </div>
        </div>

        <!-- References Section -->
        <div class="form-section">
            <h2 class="text-xl">4. References (Non-Relatives)</h2>
            <div class="grid-container sm:grid-cols-2">
                <div class="form-group">
                    <label for="ref1-name">Reference 1 Name:</label>
                    <input type="text" id="ref1-name" name="ref1-name">
                </div>
                <div class="form-group">
                    <label for="ref1-relation">Relationship:</label>
                    <input type="text" id="ref1-relation" name="ref1-relation">
                </div>
                <div class="form-group sm:col-span-2">
                    <label for="ref1-contact">Phone/Email:</label>
                    <input type="text" id="ref1-contact" name="ref1-contact">
                </div>
                <div class="form-group">
                    <label for="ref2-name">Reference 2 Name:</label>
                    <input type="text" id="ref2-name" name="ref2-name">
                </div>
                <div class="form-group">
                    <label for="ref2-relation">Relationship:</label>
                    <input type="text" id="ref2-relation" name="ref2-relation">
                </div>
                <div class="form-group sm:col-span-2">
                    <label for="ref2-contact">Phone/Email:</label>
                    <input type="text" id="ref2-contact" name="ref2-contact">
                </div>
            </div>
        </div>

        <!-- Additional Occupants Section -->
        <div class="form-section">
            <h2 class="text-xl">5. Additional Occupants</h2>
            <div class="grid-container sm:grid-cols-2">
                <div class="form-group">
                    <label for="occupants-total">Total Number of Occupants:</label>
                    <input type="text" id="occupants-total" name="occupants-total">
                </div>
                <div class="form-group sm:col-span-2">
                    <label for="dependents">Names & Ages of Dependents:</label>
                    <textarea id="dependents" name="dependents" rows="4"></textarea>
                </div>
            </div>
        </div>

        <!-- Consent & Authorization Section -->
        <div class="form-section">
            <h2 class="text-xl">6. Consent & Authorization</h2>
            <div class="form-group">
                <label class="flex items-center">
                    <input type="checkbox" name="consent-auth" required class="mr-2"> I authorize the landlord to contact my references, employers, and previous landlords.
                </label>
            </div>
            <div class="form-group">
                <label class="flex items-center">
                    <input type="checkbox" name="credit-auth" required class="mr-2"> I authorize the landlord to obtain a credit report as part of the screening process.
                </label>
            </div>
            <div class="form-group">
                <label class="flex items-center">
                    <input type="checkbox" name="certify" required class="mr-2"> I certify that the information provided is true and complete.
                </label>
            </div>
        </div>

        <!-- Signature Block -->
        <div class="signature-block">
            <div class="flex items-end justify-between mb-8 flex-col sm:flex-row">
                <div class="flex-1 w-full sm:mr-4">
                    <label>Applicant Signature:</label>
                    <input type="text" id="signature" class="signature-line border-0 border-b border-gray-400 focus:ring-0 focus:border-indigo-600 rounded-none bg-transparent" placeholder="Sign here by typing your name">
                </div>
                <div class="flex-1 w-full">
                    <label>Date:</label>
                    <input type="date" id="date" class="border-0 border-b border-gray-400 focus:ring-0 focus:border-indigo-600 rounded-none bg-transparent">
                </div>
            </div>
        </div>
    </form>

    <!-- Submit Buttons -->
    <div class="flex justify-center space-x-4 mt-6 mb-8">
        <button onclick="downloadPDF()" class="px-8 py-3 bg-indigo-600 text-white font-bold text-lg rounded-full shadow-lg hover:bg-indigo-700 focus:outline-none focus:ring-4 focus:ring-indigo-500 focus:ring-offset-2 transition-all">
            Download as PDF
        </button>
    </div>
    
    <!-- Modal for Success/Error Messages -->
    <div id="messageModal" class="fixed inset-0 bg-gray-800 bg-opacity-75 hidden flex items-center justify-center p-4">
        <div class="bg-white p-8 rounded-2xl shadow-2xl w-full max-w-md transform transition-all scale-95 duration-300">
            <h3 id="modalTitle" class="text-2xl font-bold mb-4 text-center text-gray-800"></h3>
            <p id="modalMessage" class="text-gray-600 text-center mb-6"></p>
            <div class="flex justify-center">
                <button onclick="closeModal()" class="px-6 py-2 bg-indigo-600 text-white rounded-full font-semibold hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">Close</button>
            </div>
        </div>
    </div>

    <script>
        // Function to download the PDF
        function downloadPDF() {
            if (typeof window.jspdf === 'undefined' || typeof window.html2canvas === 'undefined') {
                showModal('Error', 'Required libraries not loaded. Please try again.');
                return;
            }

            const {
                jsPDF
            } = window.jspdf;
            const element = document.getElementById('application-form');

            showModal('Generating PDF...', 'Please wait a moment while your document is being prepared.');

            window.html2canvas(element, {
                scale: 2
            }).then(canvas => {
                const imgData = canvas.toDataURL('image/png');
                const pdf = new jsPDF('p', 'mm', 'a4');
                const imgProps = pdf.getImageProperties(imgData);
                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;

                pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
                pdf.save('Rental_Application.pdf');
                closeModal();
            }).catch(error => {
                console.error('Error generating PDF:', error);
                showModal('Error', 'Failed to generate PDF. Please try again.');
            });
        }
        
        // Function to submit the form data
        async function submitForm() {
            const form = document.getElementById('application-form');
            event.preventDefault();
            console.log('submitForm called');
            const formData = new FormData(form);
            const data = {};
            formData.forEach((value, key) => {
                data[key] = value;
            });
            
            // Note: The recipient emails are now hardcoded in the backend service.
            // You will need to configure your server to receive this data and send the email to the correct recipients.

            showModal('Submitting...', 'Please wait while your application is submitted.');

            // Use the live Render backend endpoint
            const emailServiceEndpoint = 'https://rental-form-backend-gy0f.onrender.com/submit';

            try {
                const response = await fetch(emailServiceEndpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        subject: 'New Rental Application from ' + data['full-name'],
                        body: JSON.stringify(data, null, 2)
                    })
                });

                if (response.ok) {
                    showModal('Success!', 'Your application has been submitted successfully.');
                    // You can clear the form here if needed
                    // form.reset();
                } else {
                    const errorText = await response.text();
                    showModal('Submission Failed', `Something went wrong. Please try again. Error: ${errorText}`);
                }
            } catch (error) {
                console.error('Submission error:', error);
                showModal('Error', 'There was a problem submitting the form. Check your internet connection or try again later.');
            }
        }
        
        // Function to show a modal for messages
        function showModal(title, message) {
            let modal = document.getElementById('messageModal');
            if (!modal) {
                modal = document.createElement('div');
                modal.id = 'messageModal';
                modal.className = 'fixed inset-0 bg-gray-800 bg-opacity-75 hidden flex items-center justify-center p-4';
                modal.innerHTML = `
                    <div class="bg-white p-8 rounded-2xl shadow-2xl w-full max-w-md transform transition-all scale-95 duration-300">
                        <h3 id="modalTitle" class="text-2xl font-bold mb-4 text-center text-gray-800"></h3>
                        <p id="modalMessage" class="text-gray-600 text-center mb-6"></p>
                        <div class="flex justify-center">
                            <button onclick="closeModal()" class="px-6 py-2 bg-indigo-600 text-white rounded-full font-semibold hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">Close</button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            }
            
            document.getElementById('modalTitle').innerText = title;
            document.getElementById('modalMessage').innerText = message;
            modal.classList.remove('hidden');
        }

        // Function to close the modal
        function closeModal() {
            document.getElementById('messageModal').classList.add('hidden');
        }
    </script>
</body>
</html>
